<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <title>My first BootstrapVue app</title>

    <!-- Required Stylesheets -->
    <link
      type="text/css"
      rel="stylesheet"
      href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"
    />
    <link
      type="text/css"
      rel="stylesheet"
      href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"
    />

    <!-- Required scripts -->
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
  </head>
  <body>
    <!-- Our application root element -->
    <div id="app">
      <b-container>
        <b-jumbotron header="BootstrapVue" lead="Bootstrap 4 Components for Vue.js 2">
          <p>For more information visit our website</p>
          <b-btn variant="primary" href="https://bootstrap-vue.js.org/">More Info</b-btn>
        </b-jumbotron>
        
        <b-form>
        <b-form-group
          description="Let us know your name."
          label-for="name"
          label="Enter your fucking username"
        >
          <b-form-input id="name" class="mt-3" v-model="form.name"></b-form-input>
        </b-form-group>

        <b-form-group
        description="Ponte una puta contraseña por tus muertos que no queremos que un hacker ruso nos viole"
        label-for="password"
        label="Enter your fucking contraseña"
        >
          <b-form-input id="passwd" type="password" class="mt-3" v-model="form.passwd"></b-form-input>
        </b-form-group>
        
        <b-form-group
        description="el puto gmail de los cojones"
        label-for="email"
        label="Enter your fucking outlook"
        >
          <b-form-input id="email" label="Email:" class="mt-3" v-model="form.email"></b-form-input>
        </b-form-group>
        
        <b-form-group
        description="Let us know tu edad para que te juzguemos"
        label-for="birthday"
        label="Enter your fucking cumple"
        >
          <b-form-datepicker id="birthday" label="Fecha de nacimiento:" class="mt-3" v-model="form.birthday"></b-form-datepicker>
        </b-form-group>
        
        <b-form-group
        description="un selfie"
        label-for="profileImg"
        label="Enter your fucking e"
        >
          <b-form-file label="Fotito:" class="mt-3"
          id="profileImg"
          v-model="form.profileImg"
          :state="Boolean(profileImg)"
          placeholder="Pick una fuckin imagen"
          drop-placeholder="Drop file here..."
        ></b-form-file>
        </b-form-group>

        <b-button type="submit" class="mr-2" @click="createClient">dale envia</b-button>
        <b-button type="reset" class="mr-2">dale</b-button>

        
      </b-form>
      </b-container>
    </div>

    <!-- Start running your app -->
    <script>
      window.app  = new Vue({
        el: '#app',
        data: {
          form: {
          id: 1,
          name: '',
          passwd: null,
          birthday: '',
          email: '',
          profileImg: [],
        },
        created(){
        	var self = this
        	var ES = new EventSource('/news')

        	console.log('Creando listener de eventos de servidor...')

           	ES.addEventListener('updates', function(event){
              	   var data = JSON.parse(JSON.parse(event.data)) //bytes to string -> string to json
              	   console.log(data)
              	   self.users.push(data)
                }, false)

        },
        computed: {
          showAlert() {
            return this.password > 4 ? true : false
          }
        },
        
        createClient(formData){
          console.log('create client function uwu')
          var subs = []
          var self = this
          var user = {id: 1, mail: this.email, birthday: this.birthday, passwd: this.passwd, name: this.name, profileImg: this.profileImg.name, subscriptions: subscriptions}
                //Inyectamos usuarios actuales en la componente Vuw
          fetch('/user/client', {method: 'POST',
                                body: JSON.stringify(user),
                                headers:{
                                  'Content-Type': 'application/json'
                                }})
                                .then(function(r){return r.json()})
                                .then(function(j){
                                  console.log(j.result)})
          
          console.log('User created => ',this.username)
        
        }
      }
      })
    </script>
  </body>
</html>